<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cemetery.domain.mapper.PaymentRecordMapper">

    <!-- 根据支付流水号查询 -->
    <select id="selectByPaymentNo" resultType="com.cemetery.domain.entity.PaymentRecord">
        SELECT * FROM payment_record
        WHERE payment_no = #{paymentNo} AND deleted = 0
        LIMIT 1
    </select>

    <!-- 根据订单ID查询支付记录 -->
    <select id="selectByOrderId" resultType="com.cemetery.domain.entity.PaymentRecord">
        SELECT * FROM payment_record
        WHERE order_id = #{orderId} AND deleted = 0
        ORDER BY create_time DESC
    </select>

    <!-- 根据订单编号查询 -->
    <select id="selectByOrderNo" resultType="com.cemetery.domain.entity.PaymentRecord">
        SELECT * FROM payment_record
        WHERE order_no = #{orderNo} AND deleted = 0
        ORDER BY create_time DESC
    </select>

    <!-- 根据用户ID查询支付记录 -->
    <select id="selectByUserId" resultType="com.cemetery.domain.entity.PaymentRecord">
        SELECT * FROM payment_record
        WHERE user_id = #{userId} AND deleted = 0
        ORDER BY create_time DESC
    </select>

    <!-- 根据支付状态查询 -->
    <select id="selectByStatus" resultType="com.cemetery.domain.entity.PaymentRecord">
        SELECT * FROM payment_record
        WHERE payment_status = #{status} AND deleted = 0
        ORDER BY create_time DESC
    </select>

    <!-- 根据第三方交易号查询 -->
    <select id="selectByTransactionId" resultType="com.cemetery.domain.entity.PaymentRecord">
        SELECT * FROM payment_record
        WHERE transaction_id = #{transactionId} AND deleted = 0
        LIMIT 1
    </select>

    <!-- 查询待支付记录 -->
    <select id="selectPendingPayments" resultType="com.cemetery.domain.entity.PaymentRecord">
        SELECT * FROM payment_record
        WHERE payment_status = 1 AND deleted = 0
        ORDER BY create_time DESC
    </select>

    <!-- 查询用户指定状态的支付记录 -->
    <select id="selectByUserIdAndStatus" resultType="com.cemetery.domain.entity.PaymentRecord">
        SELECT * FROM payment_record
        WHERE user_id = #{userId} AND payment_status = #{status} AND deleted = 0
        ORDER BY create_time DESC
    </select>

</mapper>
